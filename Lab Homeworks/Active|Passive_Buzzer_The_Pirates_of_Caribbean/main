oid loop() {
  // put your main code here, to run repeatedly:
  if(buzzerActive){
    //The melody will be stopped when we pressed the button
    if(buttonState == LOW) {
      Serial.println("Pirates of Caribbean theme song stops!");
      digitalWrite(activeBuzzerPin, LOW);
      knockHappened = buzzerActive = false;
      buttonState = HIGH;
    }
    else{
      int reading = digitalRead(pushButton);
      // If the switch changed, due to noise or pressing
      if(reading != lastButtonState){
        //reset the debouncing timer
        lastDebounceTime = millis(); 
      }
      
      if((millis() - lastDebounceTime) > debounceDelay){
        //if the button state has changed:
        if(reading != buttonState){
          buttonState = reading;
        }
      }
      lastButtonState = reading;
    }
  }
  else{
    if(knockHappened) {
      if(millis() - lastKnock >= knockDelay){
        Play_Pirates();
        buzzerActive = true;
      }
    }
    else {
      speakerValue = analogRead(passiveBuzzerPin);
      if(speakerValue > thresholdKnock){
        Serial.println("Knock");
        knockHappened = true;
        lastKnock = millis();
      }
    }
  }
}
